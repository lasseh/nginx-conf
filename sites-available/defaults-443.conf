# vi:ft=nginx
# =============================================================================
# NGINX DEFAULT HTTPS REDIRECT (PORT 443)
# =============================================================================
# Simple redirect server that sends all HTTPS requests to HTTP
# This avoids SSL certificate complexity for the default server

server {
	# =============================================================================
	# LISTEN DIRECTIVES
	# =============================================================================

	# Listen on port 443 as the default server for all unmatched HTTPS requests
	# Why: Catches all HTTPS requests that don't match specific server names
	# Impact: Provides consistent behavior for unknown domains over HTTPS
	# Approach: Redirect to HTTP instead of serving SSL content
	listen 443 ssl default_server;
	listen [::]:443 ssl default_server;

	# Self-signed certificate for default catch-all server
	# Generate with: openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/default.key -out /etc/ssl/certs/default.crt
	ssl_certificate /etc/ssl/certs/default.crt;
	ssl_certificate_key /etc/ssl/private/default.key;
	ssl_stapling off;

	# =============================================================================
	# ERROR HANDLING FOR INVALID REQUESTS
	# =============================================================================

	# Custom 404 page for invalid domains/requests
	# Why: Provides user-friendly error instead of nginx default
	# Security: Doesn't reveal server information
	error_page 404 /404.html;

	location = /404.html {
		root /etc/nginx/html/errors;
		internal;
	}

	# Return 444 (close connection) for all other requests
	# Why: Blocks bots and malicious scanners efficiently
	# Impact: No response sent, connection closed immediately
	# Use case: Invalid domains, IP-based access attempts
	location / {
		return 444;
	}
}