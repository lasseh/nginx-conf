# =============================================================================
# MOZILLA MODERN TLS CONFIGURATION (TLS 1.3 ONLY)
# =============================================================================
# Strictest TLS configuration for maximum security
# Based on Mozilla SSL Configuration Generator (Modern)
#
# IMPORTANT: This configuration ONLY supports TLS 1.3
# Older clients will NOT be able to connect
#
# Supports: Firefox 63+, Chrome 70+, Edge 79+, Safari 12.1+
# Does NOT support: IE 11, older mobile browsers, Java 8-10, Android < 10
#
# Use this for:
#   - Internal/corporate applications
#   - High-security environments
#   - APIs with modern client requirements
#   - When you control both client and server
#
# Use tls-intermediate.conf instead for:
#   - Public websites
#   - Sites needing broad browser support
#   - E-commerce sites
#   - Any site where you don't control client software
#
# https://ssl-config.mozilla.org/

# =============================================================================
# SESSION SETTINGS
# =============================================================================

ssl_session_timeout    1d;
ssl_session_cache      shared:SSL:10m;
ssl_session_tickets    off;

# =============================================================================
# PROTOCOL CONFIGURATION - TLS 1.3 ONLY
# =============================================================================

# Only allow TLS 1.3 - no TLS 1.2 or earlier
ssl_protocols          TLSv1.3;

# TLS 1.3 manages its own ciphers, no need to specify
# The following ciphersuites are used by TLS 1.3:
#   - TLS_AES_128_GCM_SHA256
#   - TLS_AES_256_GCM_SHA384
#   - TLS_CHACHA20_POLY1305_SHA256
ssl_prefer_server_ciphers off;

# =============================================================================
# OCSP STAPLING
# =============================================================================

ssl_stapling           on;
ssl_stapling_verify    on;
resolver_timeout       2s;

# DNS resolvers for OCSP stapling
resolver
    1.1.1.1 1.0.0.1                                     # Cloudflare IPv4
    [2606:4700:4700::1111] [2606:4700:4700::1001]       # Cloudflare IPv6
    8.8.8.8 8.8.4.4                                     # Google IPv4
    [2001:4860:4860::8888] [2001:4860:4860::8844]       # Google IPv6
    valid=60s;

# =============================================================================
# ADVANCED TLS 1.3 FEATURES
# =============================================================================

# 0-RTT Early Data - enables faster reconnections
# WARNING: Early data is vulnerable to replay attacks
# Only safe for idempotent requests (GET, HEAD)
# Uncomment if you understand the implications:
# ssl_early_data on;

# If using early_data, add this header to detect replay attacks:
# proxy_set_header Early-Data $ssl_early_data;

# =============================================================================
# USAGE
# =============================================================================
#
# Replace this line in nginx.conf:
#   include conf.d/tls-intermediate.conf;
# With:
#   include conf.d/tls-modern.conf;
#
# Or use per-site by including in server blocks that need maximum security.

# =============================================================================
# TESTING
# =============================================================================
#
# 1. Test TLS version:
#    openssl s_client -connect example.com:443 -tls1_2
#    # Should fail with "no protocols available"
#
#    openssl s_client -connect example.com:443 -tls1_3
#    # Should succeed
#
# 2. Check with SSL Labs:
#    https://www.ssllabs.com/ssltest/
#    # Should show "TLS 1.3 only" and A+ rating
#
# 3. Test with curl:
#    curl -v --tlsv1.2 https://example.com
#    # Should fail
#
#    curl -v --tlsv1.3 https://example.com
#    # Should succeed
